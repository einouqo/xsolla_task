# Backend летняя школа - итоговая работа

![Build Status](https://travis-ci.org/joemccann/dillinger.svg?branch=master)

# Задача
Требуется создать многопользовательское приложение для управления складскими запасами. Приложение нужно реализовать как backend сервис работающий по протоколу HTTP и использующий стандарт RESTful API . ([Полная постановка задачи][link_t])


# Особенности

  - Реализация с использованием микрофреймворка Slim
  - JWT для работы с COOKIE
  - Хранение истории продаж и перемещения между складами
  - Разделены сущности помещения (Room) и склада (Warehouse) для возможности внедрения другого типа помещения в будущем и дальнейшего удобства сопровождения продукта
  - Перемещения фиксируются только после принятия перемещения другим пользователем, на склад которого поступают товары
  - При создании компании генерируется ключ доступа к возможности удаления компании
  - Два типа пользователя: «Admin» и «Employee» (уникальные возможности описаны ниже)
  
----
#### Admin:
- Добавить/удалить помещение (в случае удаления также удаляются все связанные данные)
- Создать/удалить склад (преобразовать помещение в склад и сделать из склада простое помещение)
- Дать/забрать доступ к складу для Employee-ра
- Получить список перемещений для конкретного склада
- Изменить данные существующего склада
- Добавить товар на склад
- Изменить данные о товаре
- Получить отчет о состоянии товара по всем складам в количестве и общей стоимости (с возможностью получить информацию на конкретную дату)
- Получить отчет о перемещении товара по складам
    
#### Employee:
- Получить список доступных товаров
- Получить список товаров, находящихся в ожидании (поставки, которые необходимо принять)
- Совершить продажу
- Принять/создать/отправить поставку
- Получить список сформированной поставки (до ее отправления)

#### Общие:
- Получить список складов (для «Admin» выводится список всех складов компании, для «Employee» список складов к которым он имеет доступ)
- Получить полную информацию по складу с учетом товаров, хранящимся на нем (с возможностью получить информацию на конкретную дату)

#### Возможности, независящие от роли пользователя:
- Получить список существующих компаний
- Зарегистрировать/удалить компанию (удаление возможно только при указании ключа, который пользователь получает при регистрации компании, а также при удалении удаляются все связанные данные)
- Зарегистрироваться как пользователь с указанием дальнейшей роли в компании («Admin» или «Employee»)
- Изменить/удалить данные о пользователе (доступно только после аутентификации и в случае удаления удаляются и все связанные с учетной записью данные)

----
## Роуты (использовался порт :8080)
- #### Регистрация компании
    - POST-запроc, `192.168.100.123:8080/company/create`
    - Параметры:
        - name - строка
- #### Список компаний
    - GET-запрос,  `192.168.100.123:8080/company/list`
- #### Удаление компании
    - DELETE-запрос, `192.168.100.123:8080/company/{id}/delete`
        - args['id'] - id компании, целочисленное значение
    - Параметры:
        - key - строка (ключ, который дается при регистрации компании)
- #### Регистрация
    - POST-запрос `192.168.100.123:8080/registration`
    - Параметры:
        - name - строка, содержащая только буквы
        - lastname - строка, содержащая только буквы
        - companyID - id компании, целочисленное значение
        - phone - строка, содержащая только цифры (ограничена сверху 11 знаками)
        - position - целочисленное значение (может принимать значения 0 или 1 «Employee» и «Admin» соответственно)
        - email - строка, фильтруемая функцией [filter_var][link_filter_var] с идентификатором фильтра `FILTER_VALIDATE_EMAIL`
        - password - строка
- #### Авторизация
    - POST-запрос `192.168.100.123:8080/user/login` 
    - Параметры:
        - email - строка, фильтруемая функцией [filter_var][link_filter_var] с идентификатором фильтра `FILTER_VALIDATE_EMAIL`
        - password - строка
- #### Изменение персональных данных
    - PUT-запрос `192.168.100.123:8080/settings/change`
        - пользователь должен быть авторизован
        - после успешного изменения данных пользователь должен перелогиниться
    - Параметры (необязательные)
        - email - строка, фильтруемая функцией [filter_var][link_filter_var] с идентификатором фильтра `FILTER_VALIDATE_EMAIL`
        - password - строка
        - name - строка, содержащая только буквы
        - lastname - строка, содержащая только буквы
        - phone - строка, содержащая только цифры (ограничена сверху 11 знаками)
- #### Удаление пользователя
    - DELETE-запрос `192.168.100.123:8080/user/settings/delete`
        - пользователь должен быть авторизован
- #### Выйти (разлогиниться)
    - GET-запрос `192.168.100.123:8080/user/exit`
- #### Дать доступ к складу
    - POST-зпрос `192.168.100.123:8080/access/give`
        - Только для «Admin»
    - Параметры
        - userID - id пользователей типа «Employee», целочисленное значение
        - warehouseID - id склада, целочисленное значение
- #### Забрать доступ к складу
    - DELETE-запрос `192.168.100.123:8080/access/delete`
        - Только для «Admin»
    - Параметры
        - userID - id пользователей типа «Employee», целочисленное значение
        - warehouseID - id склада, целочисленное значение
- #### Список помещений
    - GET-запрос `192.168.100.123:8080/rooms/list`
        - Только для «Admin»
- #### Добавить помещение
    - POST-запрос `192.168.100.123:8080/rooms/add`
        - Только для «Admin»
    - Параметры
        - address - строка
- #### Удалить помещение
    - DELETE-запрос `192.168.100.123:8080/rooms/{id}/delete`
        - args['id'] - id помещения, целочисленное значение
        - Только для «Admin»
- #### Список складов
    - GET-запрос `192.168.100.123:8080/warehouses/list`
        - Только для «Admin»
- #### Создать склад
    - POST-запрос `192.168.100.123:8080/warehouses/create`
        - Только для «Admin»
    - Параметры
        - roomID - id помещения, целочисленное значение
        - name - строка
        - capacity - неотрицательное, целочисленное значение
- #### Получить информацию по складу
    - GET-запрос `192.168.100.123:8080/warehouses/{id}/state[?date=Y-m-d H:i:s]`
        - args['id'] - id склада, целочисленное значение
        - date - необязательный параметр (если параметр задан, пользователь получает информацию по складу на указанную дату)
- #### Получить список всех перемещений товаров для склада
    - GET-запрос `192.168.100.123:8080/warehouses/{id}/transfers`
        - args['id'] - id склада, целочисленное значение
        - Только для «Admin»
- #### Изменить информацию о складе
    - PUT-запрос `192.168.100.123:8080/warehouses/{id}/change`
        - args['id'] - id склада, целочисленное значение
        - Только для «Admin»
    - Параметры (необязательные)
        - name - строка
        - capacity - неотрицательное, целочисленное значение
- #### Удаление склада
    - DELETE-запрос `192.168.100.123:8080/warehouses/{id}/delete`
        - args['id'] - id склада, целочисленное значение
        - Только для «Admin»
- #### Добавление товара на склад
    - POST-запрос `192.168.100.123:8080/items/add`
        - Только для «Admin»
    - Параметры
        - name - строка
        - type - строка
        - size - строка
        - price - неотрицательное число
        - quantity - неотрицательное, целочисленное значение
- #### Полчуить информацию о товаре
    - GET-запрос `192.168.100.123:8080/items/{id}/state[?date=Y-m-d H:i:s]`
        - args['id'] - id товара, целочисленное значение
        - Только для «Admin»
        - date - необязательный параметр (если параметр задан, пользователь получает информацию о товаре на указанную дату)
- #### Получить информацию о перемещении товара
    - GET-запрос `192.168.100.123:8080/items/{id}/transfers`
        - args['id'] - id товара
        - Только для «Admin»
- #### Изменение информации о товаре
    - PUT-запрос `192.168.100.123:8080/items/{id}/change`
        - args['id'] - id товара
        - Только для «Admin»
    - Параметры
        - name - строка
        - type - строка
        - price - строка
- #### Получить список ожидающих поставок
    - GET-запрос `192.168.100.123:8080/warehouses/items/list/pending`
        - Только для «Employee»
- #### Получить список доступных товаров
    - GET-запрос `192.168.100.123:8080/warehouses/items/list/available[?warehouseID={id}]`
        - Только для «Employee»
        - warehouseID - необязательный параметр (если параметр задан, пользователь получает информацию о товаре в указанном складе)
- #### Принять поставку
    - POST-запрос `192.168.100.123:8080/warehouses/items/take`
        - Только для «Employee»
    - Параметры
        - transferID - id «ожидающего» перемещения
- #### Продажа
    - DELETE-запрос `192.168.100.123:8080/warehouses/items/{id}/sell`
        - args['id'] - id товара
        - Только для «Employee»
    - Параметры
        - warehouseID - id склада, с которого совершается продажа
        - size - строка
        - quantity - положительное, целочисленное значение
- #### Формирование поставки
    - POST-запрос `192.168.100.123:8080/warehouses/items/4/toTransfer`
        - args['id'] - id товара
        - Только для «Employee»
    - Параметры
        - warehouseFromID - id склада с которого резервируются* товар(-ы)
        \* товары резервируются до тех пор, пока поставка не отправлена, либо не отменена
        - size - строка
        - quantity - положительное, целочисленное значение
- #### Получить список сформированной поставки
    - GET-запрос `192.168.100.123:8080/warehouses/items/transfers/list`
        - Только для «Employee»
- #### Очистить список сформированной поставки (Отменить поставку)
    - GET-запрос `192.168.100.123:8080/warehouses/items/transfers/clear`
        - Только для «Employee»
- #### Отправить поставку
    - DELETE-запрос `192.168.100.123:8080/warehouses/items/transfers/send`
        - Только для «Employee»
    - Параметры
        - warehouseToID - id склада на который отправляем поставку
----

## Модель базы данных:
>![alt text](https://cdn1.savepice.ru/uploads/2018/10/1/969477f0bd5e35fb621c4dac7f94b8d7-full.png)

Tools, Frameworks and Package 
----
- [Slim][link_slim]
- [JWT][link_jwt]
- [Firebase library][link_firebase_jwt]
- [Composer][link_composer]
- [Symfony][link_symfony]
- [doctrine/dbal][link_doctrine]
- [PHPUnit][link_phpunit]

Лицензия
----
Xsolla :)

*А вообще, Open Source. Hell Yeah!*

   [link_t]: <https://docs.google.com/document/d/1xNw8AemftD7PvV1hPtp0LJxTPYjQT83cENroMT_chkk/edit>
   [link_slim]: <https://www.slimframework.com>
   [link_jwt]: <https://jwt.io>
   [link_firebase_jwt]: <https://github.com/firebase/php-jwt>
   [link_composer]: <https://getcomposer.org>
   [link_symfony]: <https://symfony.com>
   [link_doctrine]: <https://github.com/doctrine/dbal>
   [link_phpunit]: <https://phpunit.de>
   [link_filter_var]: <http://php.net/manual/ru/function.filter-var.php>
